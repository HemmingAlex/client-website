if (self.CavalryLogger) { CavalryLogger.start_js(["LdC4Q"]); }

__d("memoizeLastByArgs",["MemoizationInstrumentation","shallowArrayEqual"],(function(a,b,c,d,e,f){"use strict";__p&&__p();function a(a,c){__p&&__p();var d=c||a.name||"unknown",f=null;c=function(){__p&&__p();for(var c=arguments.length,g=new Array(c),h=0;h<c;h++)g[h]=arguments[h];var i=b("MemoizationInstrumentation").onFunctionCall(e.id,d),j=!0;if(!(f!=null&&b("shallowArrayEqual")(g,f.args))){j=!1;var k=a.apply(void 0,g);f==null?f={args:g,ret:k}:(f.args=g,f.ret=k)}i&&i(j);return f.ret};return c}e.exports=a}),null);
__d("FBRTCScreenSharingUtils",["FBRTCExperiment","FBRTCSupport","FBRTCVersionDetection","RTCConfig","RTCUtils"],(function(a,b,c,d,e,f){"use strict";a={isGroupCallScreenSharingSupported:function(){return b("RTCConfig").ScreenSharingToGroupGK},isSupportedBrowser:function(){return b("FBRTCVersionDetection").isChrome()&&b("FBRTCVersionDetection").webrtcVersion()>=34},canUserReceiveScreenSharing:function(){return!b("FBRTCSupport").isMobileDevice()&&(b("FBRTCVersionDetection").isChromium()&&b("FBRTCVersionDetection").webrtcVersion()>=34||b("RTCUtils").isVCScreenSharingSupported())},canPeerReceiveScreenSharing:function(a){if(a.remoteSupport("screen_sharing"))return!0;return!a.remoteSupport("www")&&!a.remoteSupport("mweb")?b("RTCConfig").ScreenSharingToMobileGK?!0:b("FBRTCExperiment").gen("webrtc_enable_screen_sharing").getBool("can_share_to_mobile",!1):!1}};e.exports=a}),null);
/**
 * Copyright @ 2015 Atlassian Pty Ltd
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * @nolint
 * @preserve-header
 * @preserve-whitespace
 */
__d("sdp-interop-array-equals",[],(function $module_sdp_interop_array_equals(global,require,requireDynamic,requireLazy,module,exports){

module.exports = function arrayEquals(array) {
    // if the other array is a falsy value, return
    if (!array)
        return false;

    // compare lengths - can save a lot of time
    if (this.length != array.length)
        return false;

    for (let i = 0, l = this.length; i < l; i++) {
        // Check if we have nested arrays
        if (this[i] instanceof Array && array[i] instanceof Array) {
            // recurse into the nested arrays
            if (!arrayEquals.apply(this[i], [array[i]]))
                return false;
        } else if (this[i] != array[i]) {
            // Warning - two different object instances will never be equal:
            // {x:20} != {x:20}
            return false;
        }
    }
    return true;
};

/*  */}),null);
__d("FBRTCStatsHelpers",["Promise"],(function(a,b,c,d,e,f){__p&&__p();var g=!1,h=function(a){if(a==="host"||a==="local")return"local";if(a==="serverreflexive"||a==="srflx")return"srflx";if(a==="peerreflexive"||a==="prflx")return"prflx";return a==="relayed"||a==="relay"?"relay":"unknown_"+a},i={UNKNOWN_CONNECTION:"l:unknown-unknown;r:unknown-unknown",connectionType:function(a,b,c,d){return a!==null&&a!==void 0&&b!==null&&c!==null&&c!==void 0&&d!==null?["l:",h(a),"-",b,";","r:",h(c),"-",d].join(""):null},getVideoCapabilitiesInfo:function(a){__p&&__p();a=a.getVideoTracks();a=a[0];if(a==null)return null;if(typeof a.getCapabilities!=="function")return null;a=a.getCapabilities();var b=a.aspectRatio,c=a.facingMode,d=a.frameRate,e=a.height;a=a.width;return{facing_mode:(c=c)!=null?c:null,max_aspect_ratio:(c=b==null?void 0:b.max)!=null?c:null,max_frame_rate:(c=d==null?void 0:d.max)!=null?c:null,max_height:(d=e==null?void 0:e.max)!=null?d:null,max_width:(c=a==null?void 0:a.max)!=null?c:null,min_aspect_ratio:(e=b==null?void 0:b.min)!=null?e:null}},getMediaInputs:function(a){var b={audio_inputs:[],video_inputs:[]};a.forEach(function(a){switch(a.kind){case"videoinput":b.video_inputs.push(a.label);break;case"audioinput":b.audio_inputs.push(a.label);break}});return b},logCapabilities:function(a,b,c){a.setVideoCapabilities(i.getVideoCapabilitiesInfo(b)),a.setMediaInputs(i.getMediaInputs(c))},internalGetWindow:function(){return window},getBatteryStats:function(){return new(b("Promise"))(function(a,b){var c=i.internalGetWindow().navigator.getBattery;typeof c==="function"?a(c.call(navigator)):b()}).then(function(a){a.charging?g=!0:a.onchargingchange=function(a){a.target.charging&&(g=!0),a.target.onchargingchange=null};return{level:a.level*100,wasCharged:g}})["catch"](function(){return{placeholder:!0,level:-1,wasCharged:!1}})}};e.exports=i}),null);
__d("XVideoCallSigningController",["XController"],(function(a,b,c,d,e,f){e.exports=b("XController").create("/videocall/init/",{peer_id:{type:"FBID",required:!0},call_id:{type:"Int"},is_caller:{type:"Bool",defaultValue:!1},audio_only:{type:"Bool",defaultValue:!1},nonce:{type:"String"},meeting_id:{type:"Int"},meeting_pass:{type:"String"},initialize_video:{type:"Bool",defaultValue:!0}})}),null);
__d("RTCP2PProtocolHandler",["invariant","Promise","Bootloader","CurrentUser","DateConsts","ErrorUtils","FBLogger","FBRTCCallSummary","FBRTCCallSummaryStore","FBRTCConfig","FBRTCConsoleLogger","FBRTCConstants","FBRTCExperiment","FBRTCIceCache","FBRTCLocalMessageQueue","FBRTCLocalUploadLogLevel","FBRTCLogger","FBRTCMessage","FBRTCMessageDedup","FBRTCMessageListener","FBRTCMessageSender","FBRTCPCConfig","FBRTCPeerConnection","FBRTCPeerConnectionHelper","FBRTCRetriableMessage","FBRTCSdpUtils","FBRTCStatsHelpers","FBRTCSupport","FBRTCTurnDiscovery","FBRTCUrlManager","FBRTCUserSettings","RTCCallActions","RTCCallNUXActions","RTCCallStore","RTCCallType","RTCConfig","RTCEndCallReason","RTCGroupCallEscalationStore","RTCGroupCallEscalator","RTCOneVCActions","RTCP2PCallActions","RTCP2PCallEscalationActions","RTCP2PCallEscalationStore","RTCP2PCallEscalator","RTCP2PCallStore","RTCP2PCallWindowHandler","RTCPeerConnectionQueue","RTCSessionDescription","RTCSignalingExperiments","RTCStreamDurationTracker","RTCUserMediaConstraints","RTCUtils","RTWebClientFeatureGating","RTWebExperiments","RTWebUserActionLogger","UserAgent","clearTimeout","debounce","gkx","promiseDone","setTimeout"],(function(a,b,c,d,e,f,g){"use strict";__p&&__p();var h;a=b("DateConsts").MS_PER_MIN;c=b("DateConsts").MS_PER_SEC;var i=(d=b("FBRTCConstants")).CallEndReason,j=d.CallType,k=d.SignalingProtocol,l=d.VideoQuality,m=d.ClientReportedEventType,n=1*a,o=15*c,p=30*c;f=function(){__p&&__p();function a(){__p&&__p();var c=this;this.$4={streams:{}};this.$5=b("FBRTCLogger").getInstance();this.$6=!1;this.$7=!0;this.$8=!1;this.$9="passive";this.$10=new(b("FBRTCMessageSender"))();this.$15=new(b("FBRTCIceCache"))();this.$16=!1;this.$17=[];this.$18=!1;this.$21=null;this.$22=null;this.$24=new(b("RTCStreamDurationTracker"))("video");this.$25=new(b("RTCStreamDurationTracker"))("video");this.$26=new(b("RTCStreamDurationTracker"))("screen");this.$27=!1;this.$28=new(b("RTCPeerConnectionQueue"))();this.$31=!1;this.$49=function(a){a=a.candidate;a&&c.$62(a)};this.$50=function(a){__p&&__p();a=a.target;a=a.iceConnectionState;c.$33("RTCP2PProtocolHandler_PC_iceconnectionstatechange: "+a);(c.$22==="disconnected"||c.$22==="failed")&&a==="connected"&&c.$32("connection recovery",c.$22);c.$32("ICE connection state change",a);b("clearTimeout")(c.$21);switch(a){case"checking":c.$8=!0;break;case"connected":case"completed":c.$63();c.$64();c.$65();break;case"failed":c.$21=b("setTimeout")(function(){if(b("RTCConfig").CollaborationBrowserConfig.ICE_recovery&&b("FBRTCConfig").isVCEndpointCall()){c.$66("ICE failure");return}c.$61(new Error("ICE failed"));b("RTCP2PCallActions").setConnectionStatus("DISCONNECTED")},b("RTCConfig").CollaborationBrowserConfig.ICE_failed_timeout);break;case"disconnected":c.$21=b("setTimeout")(function(){c.$36(i.CONNECTION_DROPPED,!1,!0,!1)},b("RTCConfig").CollaborationBrowserConfig.ICE_disconnected_timeout);break;case"closed":break}};this.$69=function(){var a=c.$3.getCreatedIceCandidates();for(var b=0;b<a.length;b++)c.$62(a[b])};this.$51=function(a){a=a.target;a=a.iceGatheringState;c.$33("RTCP2PProtocolHandler_PC_icegatheringstatechange: "+a);c.$32("ICE gathering state change",a)};this.$52=function(a){var b=a.errorCode,d=a.errorText,e=a.hostCandidate;a=a.url;c.$70("RTCP2PProtocolHandler: PC icecandidateerror "+b+": "+d+". candidate: "+e);c.$32("ICE candidate error",{errorCode:b,errorText:d,hostCandidate:e,url:a})};this.$71=function(){var a;c.$23?a=i.UNSUPPORTED_VERSION:a=i.OTHER_NOT_CAPABLE;c.$36(a,!1,!0,!1,"TimedOut")};this.$55=b("debounce")(function(d){__p&&__p();var e=d.target;c.$32("offer renegotiation",{iceConnectionState:e.iceConnectionState,isNegotiationExpected:c.$7});if(e.iceConnectionState==="closed")return;else if(!c.$7){c.$32("offer renegotiation","ignore");return}else if(!b("RTCP2PCallEscalator").isNegotiationAllowed()){c.$32("offer renegotiation","not allowed - escalating");return}else if(c.$6){c.$32("offer renegotiation","retry");b("setTimeout")(function(){return c.$55(d)},100);return}c.$7=!1;var f=[];if(e.signalingState==="stable"){if(c.$8){e=b("RTCP2PCallStore").getState();e=e.signalingExperiments;if(!e.support("sdp_update"))c.internalResetConnection(),f.push("new offer");else{e=a.supportMultipleStreams();f.push("SDP update",e?"plan B":null)}c.$9="passive"}c.$32("offer renegotiation","create offer");c.$67().then(function(a){if(a.strongDiff(c.$3.getLocalDescription())){c.$32("offer renegotiation",f);return a}return null}).then(function(a){a&&(c.$8&&b("RTCP2PCallActions").setConnectionStatus("RECONNECTING"),c.$68(a)),c.$9="active"})["catch"](function(a){c.$61(new Error("Failed to create offer onNegotiationNeeded: "+a.message))})}},50);this.$56=function(d){__p&&__p();if(c.$27){c.$28.push("add",function(){return c.$56(d)});return}var e=d.stream,f=c.$72(e),g=c.$1;f===b("FBRTCConstants").StreamType.SCREEN_CONTENT?(b("RTCCallActions").addRemoteScreenStream(e,g),!a.supportMultipleStreams()&&e.getAudioTracks().length>0&&c.$25.track(e)):(b("FBRTCUserSettings").updateForRemoteStream(e),b("RTCCallActions").addRemoteStream(e,g),c.$25.track(e),b("RTCP2PCallStore").addListener(b("debounce")(function(){b("RTCP2PCallStore").getState().callType!==b("RTCCallType").AUDIO_ONLY&&c.$63()},50)));c.$18=!0;while(c.$17.length>0)c.$73(c.$17.shift());c.$32("remote stream: added",e)};this.$57=function(a){a=b("RTCCallStore").getState().remoteUsers.first();a&&!a.isVideoMuted()&&(b("RTCCallActions").toggleMuteRemoteVideo(!1,a.FBID),c.$32("on media track event",{action:"toggleMuteRemoteVideo",muted:!1,remoteUserID:a.FBID}))};this.$58=function(a){__p&&__p();if(c.$27){c.$28.push("remove",function(){return c.$58(a)});return}var d=a.stream,e=c.$72(d),f=c.$1;if(e===b("FBRTCConstants").StreamType.SCREEN_CONTENT){b("RTCCallActions").removeRemoteScreenStream(d,f);e=b("RTCCallStore").getState().remoteUsers.first();if(e){e=e.streams.first();e&&c.$25.track(e)}}else b("RTCCallActions").removeRemoteStream(d,f);c.$32("remote stream: removed",d)};this.$34=function(a){c.$33("RTCP2PProtocolHandler_Received_TURN_Creds"),c.$32("TURN credentials received",a),b("FBRTCPCConfig").setTurnCredentials(a),s(function(b){return b.setRelayIP(a.ip)})};this.$35=function(){c.$5.logError(c.$1,c.$2,"Failed to get turn creds"),c.$36(i.CLIENT_ERROR,!1,!b("RTCP2PCallStore").isCaller(),!1,"NoTurnCreds")};this.$42=function(a,b){c.$36(a,!1,!1,!1,b.toString())};this.$41=function(a,b){__p&&__p();var d=b.call_id;if(c.$81()){c.$5.logError(c.$1,c.$2,"Message sent after call ended: "+b.type);return}if(c.$1!==a||c.$2!==d)return;s(function(a){return a.onMessageSent(b)});c.$32("message sent",b)};this.$43=function(a){a=a.message+"; "+a.stackFrames[0].identifier;c.$5.logError(c.$1,c.$2,"JSError: "+a)};this.$32("call controller init");this.$33("RTCP2PProtocolHandler_constructed")}var c=a.prototype;c.init=function(a,c){__p&&__p();this.$1=a;this.$2=c;this.$33("RTCP2PProtocolHandler_init_call");if(!b("RTWebExperiments").passOfferWithWindowMessages()){a=b("FBRTCLocalMessageQueue").getPeerOfferFromStorage(this.$1);this.$32("local message queue updates",{action:"getOffer",cachedOffer:a,callID:this.$2});if(a){this.$32("call: try","not ready");c=new(b("FBRTCMessage"))(a);b("RTCP2PCallActions").processMessage(c)}}return this};c.setPreserveLocalStream=function(a){this.$30=a;return this};c.fetchTURNCredentials=function(){if(b("FBRTCConfig").isVCEndpointCall()){this.$33("RTCP2PProtocolHandler_skip_TURN_discovery");return b("Promise").resolve()}this.$32("call: try","not ready");return b("FBRTCTurnDiscovery").requestTurnCreds(this.$2.toString(),this.$1).then(this.$34,this.$35)};c.endCall=function(a,c,d){a===void 0&&(a=i.HANGUP_CALL),c===void 0&&(c=""),d===void 0&&(d=!1),b("RTCCallActions").hangup(a,c),this.$36(a,!1,!0,d,c)};c.startCall=function(a,c){__p&&__p();var d=this,e=b("RTCP2PCallStore").isCaller();this.$32("call: start process",{callTrigger:a,userCallType:this.$37(),isCaller:b("RTCP2PCallStore").isCaller()});this.$3=this.$38();this.$39();this.$28=new(b("RTCPeerConnectionQueue"))();this.$32("local message queue updates",{action:"getOffer",offer:c});var f=null;c?(this.$19=new(b("FBRTCMessage"))(c),b("FBRTCMessageDedup").check(this.$1,this.$19.callID,this.$19.msgID),f=!1):(f=!0,b("RTCP2PCallActions").setIsCaller(f));e&&!f&&this.handleCallCollision(this.$19,!1);f!==e&&(this.$32("caller mismatch",{initialValue:e,actualValue:f}),e?this.$33("RTCP2ProtocolHandler_offer_mismatch_caller_found_unexpected_cached_offer"):this.$33("RTCP2PProtocolHandler_offer_mismatch_callee_did_not_find_cached_offer"));this.$7=f;this.$19 instanceof b("FBRTCMessage")&&b("RTCP2PCallActions").processMessage(this.$19);this.$40(a,f);this.$10=new(b("FBRTCMessageSender"))();this.$10.onMessageSent=this.$41;this.$10.onSendFailure=this.$42;this.$29=new(b("RTCP2PCallEscalator"))(this.$1,this.$2,this.$10);(h||(h=b("ErrorUtils"))).addListener(this.$43,!0);b("FBRTCMessageListener").setMessageHandler(function(a){d.$44(a)});b("FBRTCConfig").isVCEndpointCall()&&b("FBRTCMessageListener").setOneVCMessegeHandler(function(a){d.$45(a)});this.$46();b("RTCP2PCallActions").setConnectionStatus("CONTACTING");b("RTCCallActions").call([this.$1],this.$3)};c.$40=function(a,c){c=b("FBRTCCallSummary").restoreOrInitialize(b("FBRTCCallSummaryStore").getInstance(),this.$1,this.$2,c,this.$19,a);c.setCallType(b("RTCP2PCallStore").getState().callType===b("RTCCallType").AUDIO_ONLY?j.VOIP:j.DIRECT_VIDEO);c.setActiveConnection("p2p");this.$47(c);b("RTCCallActions").setCallSummary(c)};c.$47=function(a){b("promiseDone")(b("FBRTCStatsHelpers").getBatteryStats(),function(c){a.addExtraInfo(b("FBRTCLogger").Key.BATTERY_START,c.level)})};c.startScreenStream=function(c){if(!a.supportMultipleStreams()){var d=b("RTCCallStore").getState();d=d.localUser;d=d.streams.first();b("RTCUtils").transferAudioTracks(c,d)}b("RTCCallActions").addLocalScreenStream(c)};c.stopScreenStream=function(c){__p&&__p();var d=b("RTCCallStore").getState();d=d.localUser;if(!d.screenStreams.includes(c))return;if(!a.supportMultipleStreams()){d=d.streams.first();b("RTCUtils").transferAudioTracks(d,c)}b("RTCCallActions").removeLocalScreenStream(c);b("RTCUtils").stopMediaStream(c)};c.updateScreenStream=function(a,c){b("RTCUtils").transferAudioTracks(c,a),b("RTCCallActions").replaceLocalScreenStream(a,c),b("RTCUtils").stopMediaStream(a)};c.$48=function(b){if(!a.supportMultipleStreams()&&b.hasScreenStream())return!0;else return!b.isVideoMuted()};c.$38=function(){__p&&__p();var a=this,c=b("RTCP2PCallStore").getState();c=c.isPeerOnMobile;c=new(b("FBRTCPeerConnection"))(k.P2P,b("FBRTCPCConfig").getConfig(),b("FBRTCPCConfig").getConstraints(c));var d,e=null,f,g;b("RTCCallStore").addListener(b("debounce")(function(){__p&&__p();var c=b("RTCCallStore").getState();c=c.localUser;if(!c||c===d)return;d=c;var h=a.$48(c);e!==h&&e!==null&&a.$10&&a.$10.sendMuteStateUpdate(a.$1,a.$2,h);e=h;h=c.streams;c=c.screenStreams;var i=c!==g,j=h!==f;j||i?(f=h,g=c,a.$39(i)):a.$24.update()},50));b("FBRTCConfig").isVCEndpointCall()&&c.createDataChannel("noop");c.addEventListener("icecandidate",this.$49);c.addEventListener("iceconnectionstatechange",this.$50);c.addEventListener("icegatheringstatechange",this.$51);c.addEventListener("icecandidateerror",this.$52);c.addEventListener("connectionstatechange",this.$53);c.addEventListener("signalingstatechange",this.$54);c.addEventListener("negotiationneeded",this.$55);c.addEventListener("addstream",this.$56);c.addEventListener("track",this.$57);c.addEventListener("removestream",this.$58);c.addEventListener("datachannel",this.$59);this.$60(c);return c};a.supportMultipleStreams=function(){var a=b("RTCP2PCallStore").getState();a=a.signalingExperiments;return a.support("multiple_streams_plan_b")||a.support("multiple_streams_unified")};c.$39=function(c){__p&&__p();c===void 0&&(c=!1);if(this.$3.getSignalingState()==="closed")return;var d=b("RTCCallStore").getState();d=d.localUser;if(!d)return;var e=d.getStream();d=d.getScreenStream();var f=[];a.supportMultipleStreams()?(d?(f.push(d),this.$26.track(d)):this.$26.update(),e?(f.push(e),this.$24.track(e)):this.$24.update()):d?(this.$26.track(d),this.$24.track(d),f.push(d)):(this.$26.update(),e&&(this.$24.track(e),f.push(e)));if(b("FBRTCPeerConnection").isTrackAPISupported()&&b("RTWebClientFeatureGating").restartVideoWithTrackAPI()&&f.length===1){d=b("FBRTCPeerConnectionHelper").resetLocalStreamWithTrackAPI(this.$3,f[0],c);this.$7=this.$7||d}else{e=b("FBRTCPeerConnectionHelper").resetLocalStreams(this.$3,f);this.$7=this.$7||e}};c.updateAddedTracksForFirefoxVideoEscalation=function(c){b("FBRTCPeerConnection").doesBrowserSupportAddTrack()||b("FBLogger")("rtc_www").mustfix("This function must be called within Firefox context"),this.$7=!0,this.$3.addStream(c),a.replaceLocalStream(c)};c.$61=function(a){this.$36(i.WEBRTC_ERROR,!1,!0,!1,a.message)};c.$66=function(a){__p&&__p();var c=this;this.$6=!0;this.$7=!1;this.$9="passive";this.internalResetConnection();this.$33("RTCP2PProtocolHandler_connection_recovery_"+a);this.$32("connection recovery",a);this.$67().then(function(a){b("RTCP2PCallActions").setConnectionStatus("RECONNECTING"),c.$68(a),c.$9="active"})["catch"](function(b){c.$61(new Error("Failed recovering from "+a))})};c.$67=function(){var a=!b("RTCP2PCallStore").isAudioOnly()||b("RTCP2PCallEscalator").initVideoInAudioCall(),c={ADD_AUDIO_NACK:b("RTCSignalingExperiments").shouldEnableAudioNack(),DISABLE_OPUS_STEREO:b("RTWebClientFeatureGating").disableOpusStereo()};return this.$3.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:a},c)};c.$62=function(a){__p&&__p();var b=a.sdpMid;if(b!=null){b=this.$3.transformLocalIceCandidateMid(b);if(window.RTCIceCandidate){var c=a.sdpMLineIndex,d=a.candidate;a=new RTCIceCandidate(babelHelpers["extends"]({candidate:d,sdpMid:b},c!=null?{sdpMLineIndex:c}:null))}else a.sdpMid=b}this.$10.sendIceCandidate(this.$1,this.$2,a)};c.$53=function(a){a.target};c.$54=function(a){a.target};c.internalResetConnection=function(){__p&&__p();var a=this;this.$7=!1;var c=this.$1,d=b("RTCCallStore").getState().remoteUsers.first(),e=d.streams,f=d.screenStreams;this.$27=!0;this.$28.clear("add");this.$28.push("remove",function(){__p&&__p();for(var a=e,d=Array.isArray(a),g=0,a=d?a:a[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var h;if(d){if(g>=a.length)break;h=a[g++]}else{g=a.next();if(g.done)break;h=g.value}h=h;b("RTCCallActions").removeRemoteStream(h,c)}for(var h=f,g=Array.isArray(h),d=0,h=g?h:h[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){if(g){if(d>=h.length)break;a=h[d++]}else{d=h.next();if(d.done)break;a=d.value}a=a;b("RTCCallActions").removeRemoteScreenStream(a,c)}});this.$3.reset().then(function(){a.$27=!1,a.$28.drain()})["catch"](function(b){a.$61(new Error("Failed to reset peer connection: "+b.message))});b("FBRTCConfig").isVCEndpointCall()&&this.$3.createDataChannel("noop")};c.$72=function(a){var c=b("FBRTCConstants").StreamType;try{switch(this.$4.streams[a.id].type){case c.SCREEN_CONTENT:return c.SCREEN_CONTENT;case c.AUDIO_VIDEO:return c.AUDIO_VIDEO;case c.AUDIO_ONLY:return c.AUDIO_ONLY;default:throw Error("no known stream type found, detecting")}}catch(b){return a.getVideoTracks().length>0?c.AUDIO_VIDEO:c.AUDIO_ONLY}};c.$63=function(){this.$24.isStarted()?this.$24.update():this.$24.start();var a=b("RTCP2PCallStore").getState();a=a.callType;a!==b("RTCCallType").AUDIO_ONLY&&(this.$25.isStarted()?this.$25.update():this.$25.start());this.$26.isStarted()?this.$26.update():this.$26.start()};c.$64=function(){var a=b("RTCP2PCallStore").getState().connectionStatus;if(a==="ESCALATING_TO_BJN")return;b("RTCP2PCallActions").setConnectionStatus("CONNECTED");this.$31||(this.$31=!0,this.$10.sendClientReportedEvent(this.$1,this.$2,m.MEDIA_CONNECTED),this.$33("RTCP2PProtocolHandler_first_time_media_connected"));s(function(a){a.onCallConnected(),a.onNetworkReady()})};c.$59=function(a){a.channel};c.startLocalVideoTracker=function(a){this.$24.track(a)};c.updateLocalVideoTracker=function(){this.$24.update()};a.initStream=function(c,d,e){b("RTWebUserActionLogger").startTimer("RTCP2PProtocolHandler_initStream");return a.internalInitStream(c,d,e).then(function(a){b("RTWebUserActionLogger").logStopTimer({timerName:"RTCP2PProtocolHandler_initStream",checkpointName:"RTCP2PProtocolHandler_initStream_success"});return a})["catch"](function(a){b("RTWebUserActionLogger").logStopTimer({timerName:"RTCP2PProtocolHandler_initStream",checkpointName:"RTCP2PProtocolHandler_initStream_failed"});throw a})};a.internalInitStream=function(c,d,e){__p&&__p();var f=b("RTCP2PCallStore").getState();f=f.isPeerOnMobile;var g=a.getDefaultVideoQuality();f&&(g=l.LQ_VIDEO);f=!c&&b("RTCP2PCallEscalator").initVideoInAudioCall();g=b("RTCUserMediaConstraints").video(g,e||"");var h=c||f?babelHelpers["extends"]({aspectRatio:{ideal:Number((16/9).toFixed(10))}},r(g)):!1;return b("RTCUtils").getUserMediaWithAudioFallback({audio:b("RTCUserMediaConstraints").audio(d||""),video:h},{optionalConstraintsOnly:!1,supportFilteredStreams:c&&b("RTWebClientFeatureGating").canUseP2PVideoFilters()}).then(function(a){__p&&__p();a.getVideoTracks().forEach(function(a){a.enabled=c});if(c)try{var b=a.getVideoTracks();b=b[0];b||q(function(a){return a.log("audio fallback",{eventDetails:{videoConstraints:h}})})}catch(a){q(function(b){return b.log("init stream error",{eventDetails:{error:a.name,message:a.message,videoConstraints:h}})})}return a})};a.replaceLocalStream=function(a,c){c===void 0&&(c=!1);var d=b("RTCCallStore").getState().localUser.streams.first();b("RTCCallActions").replaceLocalStream(d,a);c&&b("RTCUtils").stopMediaStream(d)};c.escalateToMultiway=function(){var a=b("RTCP2PCallStore").getState(),c=a.callType,d=a.offerEscalationSupport;a=a.escalationConferenceName;if(d&&a){s(function(a){return a.setEscalationInitiated()});d=c!==b("RTCCallType").AUDIO_ONLY&&(b("RTCCallStore").hasRemoteVideo()||b("RTCCallStore").hasLocalVideo());c=new(b("RTCGroupCallEscalator"))(a,d,this.$1,this.$2);c.startEscalationToMultiway()}};c.handleSwitchToMultiway=function(){__p&&__p();var a=b("RTCP2PCallStore").getState(),c=a.callType,d=a.offerEscalationSupport;a=a.escalationConferenceName;this.$6=!1;if(d&&a){s(function(a){return a.setReceivedEscalationRequest()});d=c!==b("RTCCallType").AUDIO_ONLY&&(b("RTCCallStore").hasRemoteVideo()||b("RTCCallStore").hasLocalVideo());c=new(b("RTCGroupCallEscalator"))(a,d,this.$1,this.$2);c.startEscalationToMultiway()}};c.$74=function(a,c){var d=b("gkx")("678353"),e=a&&d&&b("FBRTCSupport").isGroupCallWebtrcSupported();this.$13=e;this.$14=c;b("RTCP2PCallActions").setMultiwayEscalationSupport(e,c);s(function(a){a.setConferenceName(c),e&&a.setEscalationAvailable()})};c.$46=function(){__p&&__p();b("FBRTCUrlManager").onCallStarted(this.$1);if(this.$19){this.$6=!0;this.$7=!1;var a=this.$19.msg,c=a.sdp,d=a.attributes,e=a.offer_escalation_support;a=a.escalation_conference_name;b("RTCP2PCallActions").setRemoteSignalingExperiments(this.$19.getSignalingExperiments());this.$74(!!e,a);this.onReceivedRemoteSDP(c,"offer",d);b("RTWebExperiments").passOfferWithWindowMessages()||b("FBRTCLocalMessageQueue").clearPeerOfferFromStorage(this.$1);this.$32("local message queue updates",{action:"removeOffer",offer:this.$19,callID:this.$2});this.$19=null}this.$32("call: try",{initialOffer:this.$19})};c.$68=function(a){__p&&__p();var c=this;this.$6=!0;return this.$3.setLocalDescription(a).then(function(a){return a.toDesc()}).then(function(a){var b=a.sdp;a=a.type;a==="offer"&&(b=c.$3.transformOfferSdp(b));return{type:a,sdp:b}}).then(function(a){var d=a.sdp;a=a.type;switch(a){case"offer":b("RTCP2PCallStore").getState().signalingExperiments.support("sdp_update")&&b("RTCCallStore").getState().callInfo.conferenceState==="CONNECTED"?c.$75(d):c.$76(d);c.$16=!1;break;case"answer":c.$77(d);break;default:break}})["catch"](function(a){c.$61(new Error("Failed to set local description: unexpected SDP type"))})};c.$78=function(){return{streams:this.$79()}};c.$79=function(){__p&&__p();var a={},c=b("RTCCallStore").getState();c=c.localUser.screenStreams;for(var d=this.$3.getLocalStreams(),e=Array.isArray(d),f=0,d=e?d:d[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var g;if(e){if(f>=d.length)break;g=d[f++]}else{f=d.next();if(f.done)break;g=f.value}g=g;var h=c.includes(g)?b("FBRTCConstants").StreamType.SCREEN_CONTENT:g.getVideoTracks().length?b("FBRTCConstants").StreamType.AUDIO_VIDEO:b("FBRTCConstants").StreamType.AUDIO_ONLY;a[g.id]={type:h}}return a};c.$75=function(a){var c=b("RTCCallStore").getState();c=c.localUser;this.$10.sendSdpUpdate(this.$1,this.$2,a,!b("RTCP2PCallStore").isAudioOnly()&&!c.isVideoMuted(),this.$78())};c.$76=function(a){var c=this,d=this.$8?b("FBRTCConstants").PayloadType.PCRESTART_OFFER:b("FBRTCConstants").PayloadType.OFFER,e=b("RTCCallStore").getState();e=e.callSummary;e=e?e.getCallTrigger():"";this.$11=new(b("FBRTCRetriableMessage"))(this.$10);this.$11.addListener("sendingRetry",this.$69);this.$11.addListener("timeoutFailure",this.$71);this.$11.sendMessage(d,this.$1,this.$2,{sdp:a,hasVideo:!b("RTCP2PCallStore").isAudioOnly(),attributes:this.$78(),callTrigger:e});this.$20=b("setTimeout")(function(){c.$36(i.NO_ANSWER_TIMEOUT,!1,!0,!1,"NoAnswerTimeout")},n)};c.$80=function(a){__p&&__p();if(!Object.prototype.hasOwnProperty.call(a,"videoon"))return;a=!a.videoon;b("RTCCallActions").toggleMuteRemoteVideo(a,this.$1);for(var a=this.$3.getRemoteStreams(),c=Array.isArray(a),d=0,a=c?a:a[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var e;if(c){if(d>=a.length)break;e=a[d++]}else{d=a.next();if(d.done)break;e=d.value}e=e;if(e.getAudioTracks().length>0){this.$32("remote steam: mute toggled",e);return}}this.$25.update()};c.$77=function(a){this.$12=new(b("FBRTCRetriableMessage"))(this.$10);this.$12.addListener("sendingRetry",this.$69);var c={escalationConferenceName:this.$14,negotiatedEscalationSupport:this.$13};this.$12.sendMessage(b("FBRTCConstants").PayloadType.ANSWER,this.$1,this.$2,{sdp:a,hasVideo:!b("RTCP2PCallStore").isAudioOnly(),attributes:this.$78(),multiwayInfo:c})};c.processQueuedMessages=function(){var a=this;b("FBRTCLocalMessageQueue").drainQueue(this.$1,function(b){a.$44(b,{skipDupeCheck:!0})})};c.$44=function(a,c){__p&&__p();var d;try{d=new(b("FBRTCMessage"))(a)}catch(b){this.$5.logError(this.$1,this.$2,"Unknown data: "+JSON.stringify(a));return}this.$5.logReceivedMessage(d.peerID,d.callID,d.msg);this.$32("message received",d.msg);if(this.$81()){this.$70("RTCP2PProtocolHandler: Ignoring message (call ended): "+d.msgID);return}if(!(c==null?void 0:c.skipDupeCheck)&&!b("FBRTCMessageDedup").check(d.peerID,d.callID,d.msgID)){this.$70("RTCP2PProtocolHandler: Ignoring message (duplicate): "+d.msgID);return}if(b("RTCCallStore").getState().callInfo.conferenceState==="AWAITING_USER_START"){this.$70("RTCP2PProtocolHandler: Ignoring message (awaiting user start): "+d.msgID);return}if(this.$1&&this.$1!==d.peerID){d.isOffer()&&this.$82(d);this.$70("RTCP2PProtocolHandler: Ignoring message (different peer): "+d.msgID);return}if(!d.isForCall(this.$2,this.$14)){this.$70("RTCP2PProtocolHandler: Ignoring message (different call): "+d.msgID+"(callID: "+d.callID+")");return}this.$2&&this.$2===d.callID&&s(function(a){return a.onFullMessageReceived(d)});a=b("RTCGroupCallEscalationStore").getState().inProgress;switch(d.msgType){case b("FBRTCConstants").PayloadType.ICERESTART_OFFER:case b("FBRTCConstants").PayloadType.PCRESTART_OFFER:this.internalResetConnection();this.$83(d);break;case b("FBRTCConstants").PayloadType.OFFER:this.$83(d);break;case b("FBRTCConstants").PayloadType.ANSWER:case b("FBRTCConstants").PayloadType.ICERESTART_ANSWER:case b("FBRTCConstants").PayloadType.PCRESTART_ANSWER:b("RTCP2PCallActions").setRemoteSignalingExperiments(d.getSignalingExperiments());this.$84(d);break;case b("FBRTCConstants").PayloadType.SDP_UPDATE:this.$85(d);break;case b("FBRTCConstants").PayloadType.ICE_CANDIDATE:this.$86(d);break;case b("FBRTCConstants").PayloadType.HANGUP:this.$87(d);break;case b("FBRTCConstants").PayloadType.OFFER_ACK:this.$88(d);break;case b("FBRTCConstants").PayloadType.OFFER_NACK:this.$23=!0;break;case b("FBRTCConstants").PayloadType.ANSWER_ACK:this.$89();break;case b("FBRTCConstants").PayloadType.MSG_ACK:this.$90(d);break;case b("FBRTCConstants").PayloadType.SET_VIDEO:this.$91(d);break;case b("FBRTCConstants").PayloadType.SWITCH_TO_MULTIWAY:a||this.handleSwitchToMultiway();break;case b("FBRTCConstants").PayloadType.VIDEO_REQUEST:case b("FBRTCConstants").PayloadType.ACK:case b("FBRTCConstants").PayloadType.OK:case b("FBRTCConstants").PayloadType.PING:case b("FBRTCConstants").PayloadType.PING_ACK:case b("FBRTCConstants").PayloadType.OTHER_DISMISS:case b("FBRTCConstants").PayloadType.PRANSWER:break;default:break}this.$29.parseMessage(d)};c.$45=function(a){switch(a.msg_type){case"bjn_escalating":var c=b("RTCP2PCallStore").getState().connectionStatus;b("RTCP2PCallActions").setConnectionStatus("ESCALATING_TO_BJN");b("setTimeout")(function(){b("RTCP2PCallActions").setConnectionStatus(c)},o);break;case"participants":b("RTCOneVCActions").storeParticipants(JSON.parse(a.payload).list);break;default:break}};c.$82=function(a){__p&&__p();var c=a.peerID,d=a.callID;this.$33("RTCP2PProtocolHanlder_collision_offer_from_another_peer");var e=a.msg,f=new(b("FBRTCCallSummary"))({peerID:c,callID:d,isCaller:!1});f.setActiveConnection("p2p");f.onFullMessageReceived(a);f.setCallType(b("FBRTCSdpUtils").isVideoSupported(e.sdp)?j.DIRECT_VIDEO:j.VOIP);this.$10.sendOfferAck(c,d,e);f.onOfferAckSent(e);a=new(b("RTCEndCallReason"))(i.IN_ANOTHER_CALL);this.$92(c,d,a,!1);f.onCallEnded(a.getReasonID(),!1);f.save(b("FBRTCCallSummaryStore").getInstance())};c.$83=function(a){__p&&__p();var c=a.msg;if(!b("RTWebExperiments").enableCallCollisionFix()){this.$2&&c.call_id!==this.$2&&this.$33("RTCP2PProtcolHandler_call_collision");var d=this.$3.getSignalingState();if(d!=="stable")return}if(c.calltype){this.$10.sendOfferNack(this.$1,c.call_id,c);return}this.$10.sendOfferAck(this.$1,c.call_id,c);this.$10.sendOtherDismiss(c.call_id);this.$93(c)?this.$94(a):this.$95(a)};c.resetCollisionSummary=function(a,c){var d=a.msg;s(function(a){a.onCallEnded(i.OTHER_INSTANCE_HANDLED,!1,!1,"call_collision"+(c?"_resetConnection":"_atStart"))});var e=new(b("FBRTCCallSummary"))({peerID:this.$1,callID:d.call_id,isCaller:!1});b("RTCCallActions").setCallSummary(e);s(function(c){c.setActiveConnection("p2p"),c.onFullMessageReceived(a),c.onOfferAckSent(d),c.setCallType(b("FBRTCSdpUtils").isVideoSupported(d.sdp)?j.DIRECT_VIDEO:j.VOIP),c.setCallTrigger("call_collision")})};c.handleCallCollision=function(a,c){this.$5.logEvent(this.$1,this.$2,"Handling offer collision");this.resetCollisionSummary(a,c);if(b("RTWebExperiments").enableCallCollisionFix()){this.$2=a.callID;a=a.msg;c?this.internalResetConnection():this.$10.sendOtherDismiss(a.call_id);b("RTCCallActions").callCollision(a.call_id.toString(),this.$1);this.$33("RTCP2PProtocolHandler_handling_call_collision"+(c?"_resetConnection":"_atStart"))}};c.$94=function(a){__p&&__p();var c=a.msg;this.$80(c);this.$96();this.$97();this.$98();if(this.$2!==c.call_id){c=new(b("RTCEndCallReason"))(i.OTHER_INSTANCE_HANDLED);this.$92(this.$1,this.$2,c,!1);this.handleCallCollision(a,!0)}else this.$5.logEvent(this.$1,this.$2,"Handling offer refresh");this.$16=!1;this.$19=a;b("RTCP2PCallActions").processMessage(a);this.$46();this.$32("offer accepted",a.msgID)};c.$95=function(a){this.$5.logEvent(this.$1,this.$2,"Ignoring offer"),this.$32("offer ignored",a.msgID)};c.$85=function(a){__p&&__p();var c=this,d=a.msg;b("RTCP2PCallActions").processMessage(a);this.$80(d);switch(this.$3.getSignalingState()){case"stable":this.onReceivedRemoteSDP(this.$99("offer",a),"offer",d.attributes);break;case"have-local-offer":this.onReceivedRemoteSDP(this.$99("answer",a),"answer",d.attributes).then(function(){return c.$100()})["catch"](function(a){c.$61(new Error("Failed to handle sdp update when signaling state is 'have-local-offer': "+a.message))});break;case"have-remote-offer":b("setTimeout")(function(){return c.$85(a)},1e3);break;case"have-local-pranswer":case"have-remote-pranswer":break;case"closed":break}this.$32("SDP update",[d.sdp,d.attributes])};c.$99=function(a,c){c=c.msg;var d=b("RTCP2PCallStore").getState();d=d.isPeerOnMobile;var e=b("RTCP2PCallStore").isCaller();return a==="offer"?!d&&e&&b("UserAgent").isBrowser("Firefox")?b("FBRTCSdpUtils").setDtlsRole(c.sdp,this.$9):c.sdp:b("FBRTCSdpUtils").setDtlsRole(c.sdp,d&&!e?"passive":this.$9)};c.$100=function(){this.$6=!1};c.$65=function(){__p&&__p();var a=this.$3.getSenders().find(function(a){var b;return(a==null?void 0:(b=a.track)==null?void 0:b.kind)==="audio"&&typeof a.getParameters==="function"&&typeof a.setParameters==="function"});if(a==null)return;if(b("RTCSignalingExperiments").shouldCapAudioBitrate()){var c=b("FBRTCExperiment").getMediaQualityExperiments().getInt("max_audio_bitrate",0);if(c>0){var d=a.getParameters();d.encodings!=null?d.encodings[0].maxBitrate=c:d.encodings=[{maxBitrate:c}];b("Promise").resolve(a.setParameters(d))}else this.$5.logError(this.$1,this.$2,"received 0 for max audio bitrate")}};c.onReceivedRemoteSDP=function(a,c,d){__p&&__p();var e=this;this.$101(d);d=b("RTCP2PCallStore").getState();d=d.isPeerOnMobile;d&&(a=b("FBRTCSdpUtils").setVideoBitrateConstraint(a));c==="answer"&&(a=this.$3.transformAnswerSdp(a));return this.$3.setRemoteDescription(new(b("RTCSessionDescription"))(k.P2P,{type:c,sdp:a})).then(function(){e.$16=!0,e.$15.drainCandidates(e.$1,e.$2,function(a){return e.$3.onReceivedRemoteIceCandidate(a)})}).then(function(){e.$64();return c!=="offer"?void 0:e.$3.createAnswer({DISABLE_OPUS_STEREO:b("RTWebClientFeatureGating").disableOpusStereo(),ADD_AUDIO_NACK:b("RTCSignalingExperiments").shouldEnableAudioNack()}).then(function(a){e.$68(a),e.$32("SDP update",{answer:a.toSdp()})})}).then(function(){e.$37()===b("RTCCallType").AUDIO_ONLY&&e.$10.sendMuteStateUpdate(e.$1,e.$2,!1)})["catch"](function(a){e.$61(a);throw a})};c.$101=function(a){__p&&__p();if(a){var c=a.streams;this.$4=babelHelpers["extends"]({},this.$4,a,{streams:babelHelpers["extends"]({},this.$4.streams,c)});Object.keys(c).some(function(a){if(c[a].type===b("FBRTCConstants").StreamType.SCREEN_CONTENT){b("RTCCallActions").removeAllLocalScreenStreams(!0);return!0}return!1})}};c.$93=function(a){return a.call_id===this.$2?!0:Boolean((this.$20||!this.$19)&&(!this.$2||a.call_id!==this.$2)&&b("RTCP2PCallStore").isCaller()&&(!a.handlescollision||a.call_id<this.$2))};c.$84=function(a){__p&&__p();var c=this,d=this.$3.getSignalingState();if(d!=="have-local-offer")return;d=a.msg;this.$74(!!d.negotiated_escalation_support,d.escalation_conference_name);this.$96();this.$97();this.$10.sendAnswerAck(this.$1,this.$2,d);b("RTCP2PCallActions").processMessage(a);b("RTCP2PCallActions").setConnectionStatus("CONNECTING");this.onReceivedRemoteSDP(d.sdp,"answer",d.attributes).then(function(){c.$100(),b("RTCCallActions").callSuccess(!0)})["catch"](function(a){c.$61(new Error("Failed to handle answer on receiving remote SDP"))});this.$80(d)};c.$90=function(a){var b=a.msg;this.$11&&this.$11.isAckMsg(b)?(s(function(b){b.onMsgAckReceived(a,!0)}),this.$88(a)):this.$12&&this.$12.isAckMsg(b)&&(s(function(b){b.onMsgAckReceived(a,!1)}),this.$89())};c.$88=function(a){b("RTCP2PCallActions").setConnectionStatus("RINGING"),s(function(c){c.setUploadLogLevel(b("FBRTCLocalUploadLogLevel").getUploadLogLevel(b("FBRTCConstants").convertToUploadLogLevel(a.msg.ull)))}),this.$96()};c.$89=function(){this.$98(),this.$100(),b("RTCCallActions").incomingCallSuccess()};c.$91=function(a){this.$18?this.$73(a):(this.$70("RTCP2PProtocolHandler: P2P message "+a.msgType+" queued for delay handling"),this.$17.push(a))};c.$73=function(a){b("RTCP2PCallStore").getState().isRemoteVideoSupported&&!b("RTCP2PCallStore").isAudioOnly()&&this.$80(a.msg)};c.$86=function(a){var b=this,c=a.msg;c.call_id===this.$2&&this.$16?this.$3.onReceivedRemoteIceCandidate(c)["catch"](function(a){b.$102(c)}):this.$102(c)};c.$102=function(a){this.$15.cacheCandidate(this.$1,a.call_id,a)};c.$87=function(a){a=a.msg;var b=a.call_id,c=a.reason;a=a.subreason;b===this.$2?this.$36(c,!0,!1,!1,a):(this.$5.logError(this.$1,this.$2,"Receiving hangup for a different call: "+b.toString()),this.$32("hangup callID missmatch",b.toString()))};c.$36=function(a,c,d,e,f){__p&&__p();var g=this,h=new(b("RTCEndCallReason"))(a).setSubreason(f).setRemoteEnded(c);b("RTCCallActions").setEndCallReason(h);b("RTCCallNUXActions").refreshNUXState();a=b("RTCP2PCallEscalationStore").getState().inProgress;a&&b("RTCP2PCallEscalationActions").cancel();this.$96();this.$97();this.$98();if(this.$81()){this.$5.logError(this.$1,this.$2,"Ending an already-ended call");return}this.$5.logCallAction(this.$1,this.$2,b("FBRTCLogger").CallAction.END_CALL,h.toStrName());this.$32("call: ended",{reason:h.toStrName(),reasonID:h.getReasonID(),subReason:h.getSubreason(),isRemoteEnded:c,userCallType:this.$37(),isCaller:b("RTCP2PCallStore").isCaller()});this.$33("callSummary onCallEnded reason "+h.toStrName()+" subreason "+((f=h.getSubreason())!=null?f:""));d&&this.$92(this.$1,this.$2,h,e);this.$24.stop();this.$25.stop();this.$26.stop();this.$3&&this.$3.close();b("RTCCallActions").hangupSuccess();this.$30||b("RTCCallActions").removeAllLocalStreams(!0);b("RTCCallActions").removeAllLocalScreenStreams(!0);b("RTCCallActions").removeAllRemoteStreams(this.$1);b("RTCP2PCallActions").setConnectionStatus("DISCONNECTED");s(function(a){a.setCallType(b("RTCP2PCallEscalationStore").getState().callType),a.setVideoDurations(g.$24.getDuration(),g.$25.getDuration()),a.setScreenDuration(g.$26.getDuration()),a.onCallEnded(h.getReasonID(),c,null,h.getSubreason()),g.$33("logged end call to call summary")});a=b("RTCCallStore").getState();f=a.callSummary;this.$33("RTCCallStore call summary has end call reason: "+f.getEndCallReason());this.$33("Getting call summary with callID: "+this.$2+" and peerId "+this.$1);d=b("FBRTCCallSummaryStore").getInstance().retrieveCallSummary(this.$1,this.$2);d!=null?this.$33("CallSummaryStore has end call reason: "+d.getEndCallReason()):this.$33("Could not find call summary");h.getReasonID()===i.HANGUP_CALL&&h.getSubreason()==="CallReset"&&c&&(this.$33("window.close call window was remotely reset"),b("RTCP2PCallWindowHandler").close())};c.$37=function(){var a=b("RTCCallStore").getState();a=a.localUser;return a.isVideoMuted()&&a.isAudioMuted()?b("RTCCallType").NO_AUDIO_VIDEO:a.isVideoMuted()&&!a.isAudioMuted()?b("RTCCallType").AUDIO_ONLY:b("RTCCallType").AUDIO_VIDEO};c.shutDownP2PListenersForMultiwayEscalation=function(){__p&&__p();var a=this;this.$96();this.$97();this.$98();this.$24.stop();this.$25.stop();this.$3&&this.$3.removeAllListeners();b("setTimeout")(function(){b("RTCGroupCallEscalationStore").logToP2PCallSummary(function(c){c.setCallType(b("RTCP2PCallEscalationStore").getState().callType),c.setVideoDurations(a.$24.getDuration(),a.$25.getDuration()),c.setScreenDuration(a.$26.getDuration()),c.onCallEnded(i.HANGUP_CALL,!1,!1,"multiway escalation")}),b("RTCCallActions").completeTransitionToMultiway()},100);this.destroy()};c.$92=function(a,b,c,d){if(!this.$10)return;this.$10.sendHangup(a,b,c.getReasonID(),d,c.getSubreason());this.$10.sendOtherDismiss(b)};c.$96=function(){this.$11&&this.$11.stopRetrying()};c.$98=function(){this.$12&&this.$12.stopRetrying()};c.$97=function(){this.$20&&b("clearTimeout")(this.$20),this.$20=null};c.$81=function(){return b("RTCCallStore").getState().callInfo.conferenceState==="TERMINATED"};c.$60=function(a){__p&&__p();var c=this;q(function(d){__p&&__p();d=d.logConnectionStats(function(){var c=a.getSignalingState();return c!=="closed"?a.getStats():b("Promise").reject("peer connection closed")},c.$1,c.$2);var e=d.start,f=d.stop;d=function b(d){d=d.target;d=d.iceConnectionState;(d==="completed"||d==="connected")&&(c.$33("RTCP2PProtocolHandler_call_connected"),c.$32("call: connected"),e(),a.removeEventListener("iceconnectionstatechange",b),a.addEventListener("iceconnectionstatechange",g))};var g=function b(c){c=c.target;c=c.iceConnectionState;c==="closed"&&(f(),a.removeEventListener("iceconnectionstatechange",b))};a.addEventListener("iceconnectionstatechange",d)})};c.$32=function(a,b){var c=this;q(function(d){return d.log(a,{peerID:c.$1,callID:c.$2,eventDetails:b})})};c.destroy=function(){this.$28.clear(),b("FBRTCMessageListener").removeMessageHandler(),b("FBRTCConfig").isVCEndpointCall()&&b("FBRTCMessageListener").removeOneVCMessageHandler(),(this.$10.onMessageSent=null,this.$10.onSendFailure=null)};c.generateEscalationRequestToken=function(a){return this.$29.generateRequestToken(a)};c.generateEscalationResponseToken=function(a,b){return this.$29.generateResponseToken(a,b)};a.getDefaultVideoQuality=function(){return b("FBRTCConfig").isVCEndpointCall()||b("FBRTCConfig").useHDVideoQuality()?l.HD_VIDEO:b("CurrentUser").isWorkUser()?l.SD_VIDEO:l.LQ_VIDEO};a.showRedialButton=function(){var a=b("RTCP2PCallStore").getState();a=a.endCallReason;var c=b("RTCCallStore").getState();c=c.callSummary;return a!=null&&(a.getReasonID()===i.IGNORE_CALL||a.getReasonID()===i.NO_ANSWER_TIMEOUT)||c.getCallDuration()<=p};a.showStarRating=function(){if(b("RTWebClientFeatureGating").shouldAlwaysShowStarRating()){var c=b("RTCP2PCallStore").getState(),d=c.endCallReason;c=c.wasConnected;return c&&d!=null&&d.getReasonID()===i.HANGUP_CALL}else return!a.showRedialButton()};c.$70=function(a){this.$5.logInfo(this.$1,this.$2,a)};c.$33=function(a){b("RTWebUserActionLogger").logCheckpoint({checkpoint:a,callId:this.$2?this.$2.toString():null,callType:"p2p"})};return a}();function q(a){if(!b("FBRTCConfig").isVCEndpointCall())return;b("Bootloader").loadModules(["CollabMessengerLogger"],a,"RTCP2PProtocolHandler")}function r(a){a instanceof Object||g(0,444);return a}function s(a){var c=b("RTCCallStore").getState();c=c.callSummary;a(c);c.save(b("FBRTCCallSummaryStore").getInstance())}e.exports=f}),null);
__d("FBRTCMediaStatsReport",["FBRTCStatsHelpers"],(function(a,b,c,d,e,f){"use strict";__p&&__p();a=function(){__p&&__p();function a(a){return}var c=a.prototype;c.parseStatString=function(a,b){return a&&a[b]!=null&&a[b]!==""?a[b]:null};c.parseMediaStat=function(a,b){return a&&a[b]!=null&&a[b]!==""?Number(a[b]):null};c.getAccelerateRate=function(a){return null};c.getAudioBytesReceived=function(a){return null};c.getAudioBytesSent=function(a){return null};c.getAudioDecodingCNG=function(a){return null};c.getAudioDecodingNormal=function(a){return null};c.getAudioDecodingPLC=function(a){return null};c.getAudioDecodingPLCCNG=function(a){return null};c.getAudioJitter=function(a){return null};c.getAudioPacketsReceived=function(a){return null};c.getAudioPacketsReceivedLost=function(a){return null};c.getAudioPacketsSent=function(a){return null};c.getAudioPacketsSentLost=function(a){return null};c.getAudioReceivedRtt=function(a){return null};c.getAudioRecvKeys=function(){return[]};c.getAudioSendCodec=function(a){return null};c.getAudioSendKeys=function(){return[]};c.getAudioSendRtt=function(a){return null};c.getConnectionType=function(){return b("FBRTCStatsHelpers").UNKNOWN_CONNECTION};c.getDiscardRate=function(a){return null};c.getExpandRate=function(a){return null};c.getFramesDecoded=function(a){return null};c.getFramesEncoded=function(a){return null};c.getInboundQpSum=function(a){return null};c.getJitterBufferDelay=function(a){return null};c.getOutboundQpSum=function(a){return null};c.getPreemptiveExpandRate=function(a){return null};c.getVideoBweKeys=function(){return[]};c.getVideoBweRetransmitBitrate=function(a){return null};c.getVideoBweSendBandwidth=function(a){return null};c.getVideoBweTransmitBitrate=function(a){return null};c.getVideoBytesReceived=function(a){return null};c.getVideoBytesSent=function(a){return null};c.getVideoFrameHeightReceived=function(a){return null};c.getVideoFrameHeightSent=function(a){return null};c.getVideoFrameRateReceived=function(a){return null};c.getVideoFrameRateSent=function(a){return null};c.getVideoFrameWidthReceived=function(a){return null};c.getVideoFrameWidthSent=function(a){return null};c.getVideoPacketsReceived=function(a){return null};c.getVideoPacketsReceivedLost=function(a){return null};c.getVideoPacketsSent=function(a){return null};c.getVideoPacketsSentLost=function(a){return null};c.getVideoRecvCodec=function(a){return null};c.getVideoRecvCodecImplementationName=function(a){return null};c.getVideoRecvKeys=function(){return[]};c.getVideoSendCodec=function(a){return null};c.getVideoSendCodecImplementationName=function(a){return null};c.getVideoSendKeys=function(){return[]};c.getVideoSentRtt=function(a){return null};c.getVideoRecvCodecForConnection=function(){var a=this,b=null;this.getVideoRecvKeys().forEach(function(c){var d=a.getVideoRecvCodec(c);c=a.getVideoRecvCodecImplementationName(c);d!=null&&d!==""&&c!=null&&c!==""&&(b=d+c)});return b};c.getVideoSendCodecForConnection=function(){var a=this,b=null;this.getVideoSendKeys().forEach(function(c){var d=a.getVideoSendCodec(c);c=a.getVideoSendCodecImplementationName(c);d!=null&&d!==""&&c!=null&&c!==""&&(b=d+c)});return b};c.getAudioSendCodecForConnection=function(){var a=this,b=null;this.getAudioSendKeys().forEach(function(c){c=a.getAudioSendCodec(c);c!=null&&c!==""&&(b=c)});return b};return a}();e.exports=a}),null);
__d("FBRTCChromeMediaStatsReport",["FBRTCMediaStatsReport","FBRTCStatsHelpers"],(function(a,b,c,d,e,f){"use strict";__p&&__p();a=function(a){__p&&__p();babelHelpers.inheritsLoose(c,a);function c(b){__p&&__p();var c;c=a.call(this,b)||this;c.$FBRTCChromeMediaStatsReport1={};c.$FBRTCChromeMediaStatsReport2={};c.$FBRTCChromeMediaStatsReport3={};c.$FBRTCChromeMediaStatsReport4={};c.$FBRTCChromeMediaStatsReport5={};c.$FBRTCChromeMediaStatsReport6=[];if(b)for(var b=b.values(),d=Array.isArray(b),e=0,b=d?b:b[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var f;if(d){if(e>=b.length)break;f=b[e++]}else{e=b.next();if(e.done)break;f=e.value}f=f;f.type==="ssrc"&&f.audioOutputLevel!=null&&f.audioOutputLevel!==""?c.$FBRTCChromeMediaStatsReport1[f.id]=f:f.type==="ssrc"&&f.audioInputLevel!=null&&f.audioInputLevel!==""?c.$FBRTCChromeMediaStatsReport2[f.id]=f:f.type==="ssrc"&&f.mediaType==="video"?f.bytesReceived!=null?c.$FBRTCChromeMediaStatsReport3[f.id]=f:c.$FBRTCChromeMediaStatsReport4[f.id]=f:f.type==="VideoBwe"?c.$FBRTCChromeMediaStatsReport5[f.id]=f:f.type==="googCandidatePair"&&f.googActiveConnection!==null&&f.googActiveConnection==="true"&&c.$FBRTCChromeMediaStatsReport6.push(f)}return c}var d=c.prototype;d.getAudioSendKeys=function(){return Object.keys(this.$FBRTCChromeMediaStatsReport2)};d.getAudioRecvKeys=function(){return Object.keys(this.$FBRTCChromeMediaStatsReport1)};d.getVideoRecvKeys=function(){return Object.keys(this.$FBRTCChromeMediaStatsReport3)};d.getVideoSendKeys=function(){return Object.keys(this.$FBRTCChromeMediaStatsReport4)};d.getVideoBweKeys=function(){return Object.keys(this.$FBRTCChromeMediaStatsReport5)};d.getAudioBytesSent=function(a){return this.parseMediaStat(this.$FBRTCChromeMediaStatsReport2[a],"bytesSent")};d.getAudioDecodingPLC=function(a){return this.parseMediaStat(this.$FBRTCChromeMediaStatsReport1[a],"googDecodingPLC")};d.getAudioDecodingPLCCNG=function(a){return this.parseMediaStat(this.$FBRTCChromeMediaStatsReport1[a],"googDecodingPLCCNG")};d.getAudioDecodingCNG=function(a){return this.parseMediaStat(this.$FBRTCChromeMediaStatsReport1[a],"googDecodingCNG")};d.getAudioDecodingNormal=function(a){return this.parseMediaStat(this.$FBRTCChromeMediaStatsReport1[a],"googDecodingNormal")};d.getAudioPacketsSentLost=function(a){return this.parseMediaStat(this.$FBRTCChromeMediaStatsReport2[a],"packetsLost")};d.getAudioPacketsSent=function(a){return this.parseMediaStat(this.$FBRTCChromeMediaStatsReport2[a],"packetsSent")};d.getAudioSendCodec=function(a){return this.parseStatString(this.$FBRTCChromeMediaStatsReport2[a],"googCodecName")};d.getAudioSendRtt=function(a){return this.parseMediaStat(this.$FBRTCChromeMediaStatsReport2[a],"googRtt")};d.getAudioBytesReceived=function(a){return this.parseMediaStat(this.$FBRTCChromeMediaStatsReport1[a],"bytesReceived")};d.getAudioPacketsReceived=function(a){return this.parseMediaStat(this.$FBRTCChromeMediaStatsReport1[a],"packetsReceived")};d.getAudioPacketsReceivedLost=function(a){return this.parseMediaStat(this.$FBRTCChromeMediaStatsReport1[a],"packetsLost")};d.getAudioReceivedRtt=function(a){return this.parseMediaStat(this.$FBRTCChromeMediaStatsReport1[a],"googRtt")};d.getVideoBytesReceived=function(a){return this.parseMediaStat(this.$FBRTCChromeMediaStatsReport3[a],"bytesReceived")};d.getVideoPacketsReceived=function(a){return this.parseMediaStat(this.$FBRTCChromeMediaStatsReport3[a],"packetsReceived")};d.getVideoPacketsReceivedLost=function(a){return this.parseMediaStat(this.$FBRTCChromeMediaStatsReport3[a],"packetsLost")};d.getFramesDecoded=function(a){return this.parseMediaStat(this.$FBRTCChromeMediaStatsReport3[a],"framesDecoded")};d.getInboundQpSum=function(a){return this.parseMediaStat(this.$FBRTCChromeMediaStatsReport3[a],"qpSum")};d.getVideoFrameHeightReceived=function(a){return this.parseMediaStat(this.$FBRTCChromeMediaStatsReport3[a],"googFrameHeightReceived")};d.getVideoFrameRateReceived=function(a){return this.parseMediaStat(this.$FBRTCChromeMediaStatsReport3[a],"googFrameRateReceived")};d.getVideoFrameWidthReceived=function(a){return this.parseMediaStat(this.$FBRTCChromeMediaStatsReport3[a],"googFrameWidthReceived")};d.getFramesEncoded=function(a){return this.parseMediaStat(this.$FBRTCChromeMediaStatsReport4[a],"framesEncoded")};d.getVideoBytesSent=function(a){return this.parseMediaStat(this.$FBRTCChromeMediaStatsReport4[a],"bytesSent")};d.getVideoFrameHeightSent=function(a){return this.parseMediaStat(this.$FBRTCChromeMediaStatsReport4[a],"googFrameHeightSent")};d.getVideoFrameRateSent=function(a){return this.parseMediaStat(this.$FBRTCChromeMediaStatsReport4[a],"googFrameRateSent")};d.getVideoFrameWidthSent=function(a){return this.parseMediaStat(this.$FBRTCChromeMediaStatsReport4[a],"googFrameWidthSent")};d.getVideoPacketsSent=function(a){return this.parseMediaStat(this.$FBRTCChromeMediaStatsReport4[a],"packetsSent")};d.getVideoPacketsSentLost=function(a){return this.parseMediaStat(this.$FBRTCChromeMediaStatsReport4[a],"packetsLost")};d.getVideoSentRtt=function(a){return this.parseMediaStat(this.$FBRTCChromeMediaStatsReport4[a],"googRtt")};d.getOutboundQpSum=function(a){return this.parseMediaStat(this.$FBRTCChromeMediaStatsReport4[a],"qpSum")};d.getAudioJitter=function(a){return this.parseMediaStat(this.$FBRTCChromeMediaStatsReport1[a],"googJitterReceived")};d.getJitterBufferDelay=function(a){return this.parseMediaStat(this.$FBRTCChromeMediaStatsReport1[a],"googCurrentDelayMs")};d.getAccelerateRate=function(a){return this.parseMediaStat(this.$FBRTCChromeMediaStatsReport1[a],"googAccelerateRate")};d.getPreemptiveExpandRate=function(a){return this.parseMediaStat(this.$FBRTCChromeMediaStatsReport1[a],"googPreemptiveExpandRate")};d.getExpandRate=function(a){return this.parseMediaStat(this.$FBRTCChromeMediaStatsReport1[a],"googExpandRate")};d.getDiscardRate=function(a){return this.parseMediaStat(this.$FBRTCChromeMediaStatsReport1[a],"googSecondaryDiscardedRate")};d.getVideoBweRetransmitBitrate=function(a){return this.parseMediaStat(this.$FBRTCChromeMediaStatsReport5[a],"googRetransmitBitrate")};d.getVideoBweSendBandwidth=function(a){return this.parseMediaStat(this.$FBRTCChromeMediaStatsReport5[a],"googAvailableSendBandwidth")};d.getVideoBweTransmitBitrate=function(a){return this.parseMediaStat(this.$FBRTCChromeMediaStatsReport5[a],"googTransmitBitrate")};d.getVideoRecvCodec=function(a){return this.parseStatString(this.$FBRTCChromeMediaStatsReport3[a],"googCodecName")};d.getVideoRecvCodecImplementationName=function(a){return this.parseStatString(this.$FBRTCChromeMediaStatsReport3[a],"codecImplementationName")};d.getVideoSendCodec=function(a){return this.parseStatString(this.$FBRTCChromeMediaStatsReport4[a],"googCodecName")};d.getVideoSendCodecImplementationName=function(a){return this.parseStatString(this.$FBRTCChromeMediaStatsReport4[a],"codecImplementationName")};d.getConnectionType=function(){var a=this,c=null;this.$FBRTCChromeMediaStatsReport6.some(function(d){c=b("FBRTCStatsHelpers").connectionType(a.parseStatString(d,"googLocalCandidateType"),a.parseStatString(d,"googTransportType"),a.parseStatString(d,"googRemoteCandidateType"),a.parseStatString(d,"googTransportType"));return c!==null});if(c!==null)return c;else return b("FBRTCStatsHelpers").UNKNOWN_CONNECTION};return c}(b("FBRTCMediaStatsReport"));e.exports=a}),null);
__d("FBRTCMozMediaStatsReport",["FBRTCMediaStatsReport","FBRTCStatsHelpers","isFalsey"],(function(a,b,c,d,e,f){"use strict";__p&&__p();a=function(a){__p&&__p();babelHelpers.inheritsLoose(c,a);function c(b){__p&&__p();var c;c=a.call(this,b)||this;c.$FBRTCMozMediaStatsReport1={};c.$FBRTCMozMediaStatsReport2={};c.$FBRTCMozMediaStatsReport3={};c.$FBRTCMozMediaStatsReport4={};c.$FBRTCMozMediaStatsReport5={};c.$FBRTCMozMediaStatsReport6={};for(var b=b.values(),d=Array.isArray(b),e=0,b=d?b:b[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var f;if(d){if(e>=b.length)break;f=b[e++]}else{e=b.next();if(e.done)break;f=e.value}f=f;f.type==="inbound-rtp"&&f.mediaType==="audio"&&f.isRemote===!1?c.$FBRTCMozMediaStatsReport1[f.id]=f:f.type==="outbound-rtp"&&f.mediaType==="audio"&&f.isRemote===!1?c.$FBRTCMozMediaStatsReport2[f.id]=f:f.type==="inbound-rtp"&&f.mediaType==="video"&&f.isRemote===!1?c.$FBRTCMozMediaStatsReport3[f.id]=f:f.type==="outbound-rtp"&&f.mediaType==="video"&&f.isRemote===!1?c.$FBRTCMozMediaStatsReport4[f.id]=f:f.type==="candidate-pair"&&f.state==="succeeded"?c.$FBRTCMozMediaStatsReport6[f.id]=f:(f.type==="local-candidate"||f.type==="remote-candidate")&&(c.$FBRTCMozMediaStatsReport5[f.id]=f)}return c}var d=c.prototype;d.getAudioSendKeys=function(){return Object.keys(this.$FBRTCMozMediaStatsReport2)};d.getAudioRecvKeys=function(){return Object.keys(this.$FBRTCMozMediaStatsReport1)};d.getVideoRecvKeys=function(){return Object.keys(this.$FBRTCMozMediaStatsReport3)};d.getVideoSendKeys=function(){return Object.keys(this.$FBRTCMozMediaStatsReport4)};d.getAudioBytesSent=function(a){return this.parseMediaStat(this.$FBRTCMozMediaStatsReport2[a],"bytesSent")};d.getAudioPacketsSent=function(a){return this.parseMediaStat(this.$FBRTCMozMediaStatsReport2[a],"packetsSent")};d.getAudioBytesReceived=function(a){return this.parseMediaStat(this.$FBRTCMozMediaStatsReport1[a],"bytesReceived")};d.getAudioPacketsReceived=function(a){return this.parseMediaStat(this.$FBRTCMozMediaStatsReport1[a],"packetsReceived")};d.getAudioPacketsReceivedLost=function(a){return this.parseMediaStat(this.$FBRTCMozMediaStatsReport1[a],"packetsLost")};d.getAudioReceivedRtt=function(a){return this.parseMediaStat(this.$FBRTCMozMediaStatsReport1[a],"roundTripTime")};d.getFramesDecoded=function(a){return this.parseMediaStat(this.$FBRTCMozMediaStatsReport3[a],"framesDecoded")};d.getFramesEncoded=function(a){return this.parseMediaStat(this.$FBRTCMozMediaStatsReport4[a],"framesEncoded")};d.getVideoBytesReceived=function(a){return this.parseMediaStat(this.$FBRTCMozMediaStatsReport3[a],"bytesReceived")};d.getVideoFrameRateReceived=function(a){var c=this.getFramesDecoded(a);return b("isFalsey")(c)?null:this.parseMediaStat(this.$FBRTCMozMediaStatsReport3[a],"framerateMean")};d.getVideoPacketsReceived=function(a){return this.parseMediaStat(this.$FBRTCMozMediaStatsReport3[a],"packetsReceived")};d.getVideoPacketsReceivedLost=function(a){return this.parseMediaStat(this.$FBRTCMozMediaStatsReport3[a],"packetsLost")};d.getVideoBytesSent=function(a){return this.parseMediaStat(this.$FBRTCMozMediaStatsReport4[a],"bytesSent")};d.getVideoFrameRateSent=function(a){var c=this.getFramesEncoded(a);return b("isFalsey")(c)?null:this.parseMediaStat(this.$FBRTCMozMediaStatsReport4[a],"framerateMean")};d.getVideoPacketsSent=function(a){return this.parseMediaStat(this.$FBRTCMozMediaStatsReport4[a],"packetsSent")};d.getAudioJitter=function(a){return this.parseMediaStat(this.$FBRTCMozMediaStatsReport1[a],"jitter")};d.getJitterBufferDelay=function(a){return this.parseMediaStat(this.$FBRTCMozMediaStatsReport1[a],"mozJitterBufferDelay")};d.getConnectionType=function(){__p&&__p();var a=this,c=null;Object.keys(this.$FBRTCMozMediaStatsReport6).forEach(function(d){d=a.$FBRTCMozMediaStatsReport6[d];var e=a.parseStatString(d,"localCandidateId");d=a.parseStatString(d,"remoteCandidateId");e!==void 0&&e!==null&&d!==void 0&&d!==null&&(c=b("FBRTCStatsHelpers").connectionType(a.parseStatString(a.$FBRTCMozMediaStatsReport5[e],"candidateType"),a.parseStatString(a.$FBRTCMozMediaStatsReport5[e],"transport"),a.parseStatString(a.$FBRTCMozMediaStatsReport5[d],"candidateType"),a.parseStatString(a.$FBRTCMozMediaStatsReport5[d],"transport")));return c!==null});if(c!==null)return c;else return b("FBRTCStatsHelpers").UNKNOWN_CONNECTION};return c}(b("FBRTCMediaStatsReport"));e.exports=a}),null);
__d("FBRTCMediaMetricParser",["FBRTCChromeMediaStatsReport","FBRTCConstants","FBRTCLogger","FBRTCMediaMetricsConst","FBRTCMozMediaStatsReport","FBRTCNetworkQualityMonitor","FBRTCSupport","RTCCallStore","RTCWebMediaStreamsTypedLogger","RTWebClientFeatureGating","UserAgent","gkx","qex"],(function(a,b,c,d,e,f){"use strict";__p&&__p();var g=b("FBRTCConstants").SignalingProtocol,h=5e3;function i(){if(b("gkx")("678354")){var a=b("RTCCallStore").getState(),c=a.callInfo;a=a.callSummary;return new(b("RTCWebMediaStreamsTypedLogger"))().setCallID(c.callID).setTimeElapsed(a.getCurrentTimeFromCallConnected()).setConferenceName(c.conferenceName).setCallType(c.protocol===g.MULTIWAY?"mw":"p2p")}return null}function j(a,c){a.getVideoSendKeys().forEach(function(d){var e,f=a.getOutboundQpSum(d),g=a.getFramesEncoded(d),h=a.getVideoBytesSent(d),j=a.getVideoPacketsSent(d),k=a.getVideoPacketsSentLost(d);c.setVideoMetric(d,(e=b("FBRTCMediaMetricsConst")).OUTBOUND_QP,f);c.setVideoMetric(d,e.FRAMES_ENCODED,g);c.setVideoMetric(d,e.VIDEO_BYTES_SENT,h);c.setVideoMetric(d,e.VIDEO_PKTS_SENT,j);c.setVideoMetric(d,e.VIDEO_PKTS_SEND_LOST,k);e=i();e&&e.setIsLocal(!0).setStreamType("video").setStreamID(d).setFrames(g).setQpSum(f).setBytes(h).setPackets(j).setPacketsLost(k).setFrameHeight(a.getVideoFrameHeightSent(d)).setFramesPerSecond(a.getVideoFrameRateSent(d)).setFrameWidth(a.getVideoFrameWidthSent(d)).log()})}function k(a,c){a.getVideoBweKeys().forEach(function(d){var e=a.getVideoBweSendBandwidth(d),f=a.getVideoBweTransmitBitrate(d),g=a.getVideoBweRetransmitBitrate(d);c.setVideoMetric(d,b("FBRTCMediaMetricsConst").VIDEOBWE_SEND_BANDWIDTH,e);c.setVideoMetric(d,b("FBRTCMediaMetricsConst").VIDEOBWE_TRANSMIT_BITRATE,f);c.setVideoMetric(d,b("FBRTCMediaMetricsConst").VIDEOBWE_RETRANSMIT_BITRATE,g);f=i();f&&f.setIsLocal(!0).setStreamType("video").setStreamID(d).setBytes(e).log()})}function l(a,c){a.getVideoRecvKeys().forEach(function(d){var e,f=a.getInboundQpSum(d),g=a.getFramesDecoded(d),h=a.getVideoBytesReceived(d),j=a.getVideoPacketsReceived(d),k=a.getVideoPacketsReceivedLost(d);c.setVideoMetric(d,(e=b("FBRTCMediaMetricsConst")).VIDEO_BYTES_RECEIVED,h);c.setVideoMetric(d,e.INBOUND_QP,f);c.setVideoMetric(d,e.FRAMES_DECODED,g);c.setVideoMetric(d,e.VIDEO_PKTS_RECEIVED,j);c.setVideoMetric(d,e.VIDEO_PKTS_RECV_LOST,k);e=i();e&&e.setIsLocal(!1).setStreamType("video").setStreamID(d).setBytes(h).setFrames(g).setQpSum(f).setPackets(j).setPacketsLost(k).setFrameHeight(a.getVideoFrameHeightReceived(d)).setFramesPerSecond(a.getVideoFrameRateReceived(d)).setFrameWidth(a.getVideoFrameWidthReceived(d)).log()})}function m(a,c){a.getAudioSendKeys().forEach(function(d){var e,f=a.getAudioBytesSent(d),g=a.getAudioPacketsSent(d),h=a.getAudioPacketsSentLost(d),j=a.getAudioSendRtt(d);c.addMetricStat(d,(e=b("FBRTCMediaMetricsConst")).AUDIO_BYTES_SENT,f);c.addMetricStat(d,e.AUDIO_PACKETS_SENT,g);c.addMetricStat(d,e.AUDIO_PACKETS_SENT_LOST,h);c.addMetricStat(d,e.AUDIO_RTT_SENT,j);e=i();e&&e.setIsLocal(!0).setStreamType("audio").setStreamID(d).setPackets(g).setBytes(f).setRtt(j).setPacketsLost(h).log()})}function n(a,c){__p&&__p();a.getAudioRecvKeys().forEach(function(d){__p&&__p();var e,f=a.getJitterBufferDelay(d),g=a.getAudioJitter(d),h=a.getAccelerateRate(d),j=a.getExpandRate(d),k=a.getPreemptiveExpandRate(d),l=a.getDiscardRate(d),m=a.getAudioBytesReceived(d),n=a.getAudioPacketsReceived(d),o=a.getAudioPacketsReceivedLost(d),p=a.getAudioReceivedRtt(d);c.addJitterBufferDelay(d,f);c.addMetricStat(d,(e=b("FBRTCMediaMetricsConst")).JITTER,g);c.addMetricStat(d,e.ACCELERATE_RATE,h);c.addMetricStat(d,e.DISCARD_RATE,l);c.addMetricStat(d,e.EXPAND_RATE,j);c.addMetricStat(d,e.PREEMPTIVE_RATE,k);c.addMetricStat(d,e.DECODING_PLC,a.getAudioDecodingPLC(d));c.addMetricStat(d,e.DECODING_CNG,a.getAudioDecodingCNG(d));c.addMetricStat(d,e.DECODING_NORMAL,a.getAudioDecodingNormal(d));c.addMetricStat(d,e.DECODING_PLC_CNG,a.getAudioDecodingPLCCNG(d));c.addMetricStat(d,e.AUDIO_BYTES_RECEIVED,m);c.addMetricStat(d,e.AUDIO_PACKETS_RECEIVED,n);c.addMetricStat(d,e.AUDIO_PACKETS_RECEIVED_LOST,o);c.addMetricStat(d,e.AUDIO_RTT_RECEIVED,p);h=i();h&&h.setIsLocal(!1).setStreamType("audio").setStreamID(d).setJitter(g).setJitterBufferDelay(f).setBytes(m).setPackets(n).setRtt(p).setPacketsLost(o).log()})}var o={lastProcessedTime:0,parseStats:function(a,c){__p&&__p();a=a.getStats();if(b("qex")._("885213")){var d,e=Date.now();b("qex")._("885214")&&(a=a.then(function(a){JSON.stringify(a);return a}));d=(d=b("qex")._("885215"))!=null?d:h;if(h-(e-o.lastProcessedTime)>d/2)return;o.lastProcessedTime=e}a.then(function(a){var d=null;b("FBRTCSupport").isChromiumBased()?d=new(b("FBRTCChromeMediaStatsReport"))(a):b("UserAgent").isBrowser("Firefox")&&(d=new(b("FBRTCMozMediaStatsReport"))(a));d&&o.parseStatsWithReport(d,c)})["catch"](function(a){b("FBRTCLogger").getInstance().logToConsole("error parsing RTCStatsReport")})},parseStatsWithReport:function(a,b){__p&&__p();var c=b.getMediaMetricTracker();n(a,c);m(a,c);l(a,c);j(a,c);k(a,c);b.setConnectionType(a.getConnectionType());c=a.getVideoRecvCodecForConnection();c!=null&&c!==""&&b.setVideoReceivedCodec(c);c=a.getVideoSendCodecForConnection();c!=null&&c!==""&&b.setVideoSentCodec(c);c=a.getAudioSendCodecForConnection();c!=null&&c!==""&&b.setAudioSentCodec(c)},startCollectingMediaStats:function(){__p&&__p();var a=null;(b("RTWebClientFeatureGating").shouldShowNetworkQualityIndicator()||b("RTWebClientFeatureGating").shouldMonitorNetworkQuality())&&(a=new(b("FBRTCNetworkQualityMonitor"))());var c=function c(){var d=b("RTCCallStore").getState().callInfo.conferenceState,e=b("RTCCallStore").getState().callSummary,f=b("RTCCallStore").getState().connections.first();if(d!=="TERMINATED"){f&&(o.parseStats(f,e),a!=null&&a.determineQuality(e.getMediaMetricTracker()));if(b("qex")._("885213")){f=(d=b("qex")._("885215"))!=null?d:h;window.setTimeout(c,f)}else window.setTimeout(c,h)}};c()}};e.exports=o}),null);
__d("FBRTCNetworkQualityMonitor",["FBRTCExperiment","FBRTCMediaMetricsConst","RTCP2PCallActions","RTWebClientFeatureGating","RTWebUserActionLogger"],(function(a,b,c,d,e,f){"use strict";__p&&__p();var g=2;a=function(){__p&&__p();function a(){this.$3=0;var a=b("FBRTCExperiment").getMediaQualityExperiments();this.$1=a.getInt("rtt_threshold",Number.POSITIVE_INFINITY);this.$2=parseFloat(a.getParam("packet_loss_rate_threshold",String(Number.POSITIVE_INFINITY)));b("RTWebUserActionLogger").logEvent({eventName:"checkpoint",checkpoint:"FBRTCNetworkQualityMonitor constructed: rtt "+this.$1+", packetLoss "+this.$2})}var c=a.prototype;c.$4=function(a,b,c){a=a.getMetricStats(b,c);return a!=null?a.current>this.$1:!1};c.$5=function(a,b){a=a/(a+b);return a>=this.$2};c.$6=function(a,b,c,d){c=a.getMetricStats(b,c);a=a.getMetricStats(b,d);return c!=null&&a!=null?this.$5(c.current,a.current):!1};c.$7=function(a,b,c){var d=this,e=c.packetLostKey,f=c.packetsKey,g=c.rttKey;c=b.some(function(b){var c=d.$6(a,b,e,f);return c||d.$4(a,b,g)});return c};c.getCount=function(){return this.$3};c.determineQuality=function(a){var c,d=this.$3,e=this.$7(a,a.getAudioStreamReportKeys(),{packetLostKey:(c=b("FBRTCMediaMetricsConst")).AUDIO_PACKETS_SENT_LOST,packetsKey:c.AUDIO_PACKETS_SENT,rttKey:c.AUDIO_RTT_SENT});a=this.$7(a,a.getAudioStreamReportKeys(),{packetLostKey:c.AUDIO_PACKETS_RECEIVED_LOST,packetsKey:c.AUDIO_PACKETS_RECEIVED,rttKey:c.AUDIO_RTT_RECEIVED});e||a?this.$3<g&&this.$3++:this.$3>0&&this.$3--;d!==this.$3&&this.$3>=g?(b("RTWebUserActionLogger").logCheckpoint({checkpoint:"poor_network_quality_exceeded_threshold_"+this.$3}),b("RTWebClientFeatureGating").shouldShowNetworkQualityIndicator()&&b("RTCP2PCallActions").togglePoorNetworkQualityIndicator(!0)):d>0&&this.$3<=0&&(b("RTWebUserActionLogger").logCheckpoint({checkpoint:"network_quality_recovered_from_"+d}),b("RTWebClientFeatureGating").shouldShowNetworkQualityIndicator()&&b("RTCP2PCallActions").togglePoorNetworkQualityIndicator(!1))};return a}();e.exports=a}),null);